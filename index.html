<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Happy Birthday</title>
<style>
  body {
    margin: 0;
    font-family: "Hiragino Maru Gothic ProN", sans-serif;
    overflow-x: hidden;
    background: #fef6e4;
  }

  /* å°ç­’ */
  .envelope {
    position: relative;
    width: 220px;
    height: 140px;
    background: #ffb3c6;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    overflow: hidden;
    z-index: 3;
    margin: 100px auto;
  }

  .flap {
    position: absolute;
    top: 0; left: 0;
    width: 0; height: 0;
    border-left: 110px solid transparent;
    border-right: 110px solid transparent;
    border-bottom: 70px solid #ff8fab;
    transform-origin: top;
    transition: transform 0.5s ease;
    z-index: 4;
  }

  .bottom {
    position: absolute;
    bottom: 0; left: 0;
    width: 0; height: 0;
    border-left: 110px solid transparent;
    border-right: 110px solid transparent;
    border-top: 70px solid #ff8fab;
    z-index: 2;
  }

  /* æ‰‹ç´™ */
  .letter {
    position: absolute;
    top: 20px; left: 10px;
    width: 200px; height: 100px;
    background: white;
    border: 2px solid #ff8fab;
    border-radius: 6px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    text-align: center;
    padding: 10px;
    transform: translateY(100%);
    transition: transform 0.6s ease;
    z-index: 3;
  }

  .letter h2 { margin: 0 0 10px; font-size: 18px; color: #ff4d6d; }
  .letter p { margin: 0; font-size: 14px; color: #333; }

  .open .flap { transform: rotateX(180deg); }
  .open .letter { transform: translateY(0); }

  /* èƒŒæ™¯ã®æš—å¹• */
  .overlay {
    position: fixed; top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.5);
    opacity: 0; pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 5;
  }
  .overlay.active { opacity:1; pointer-events:auto; }

  /* æ‰‹ç´™ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— */
  .popup {
    position: fixed; top:50%; left:50%;
    transform: translate(-50%, -50%) scale(0.8);
    width:300px; padding:20px;
    background:white;
    border:2px solid #ff8fab;
    border-radius:10px;
    box-shadow:0 6px 20px rgba(0,0,0,0.3);
    opacity:0; pointer-events:none;
    transition: all 0.4s ease;
    z-index:10; text-align:center;
  }
  .popup.active {
    opacity:1; pointer-events:auto;
    transform: translate(-50%, -50%) scale(1);
  }

  .heart { position: fixed; color: #ff4d6d; pointer-events: none; z-index: 20; will-change: transform; }

  #bottom-section {
    height: 100vh;
    position: relative;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }

  .smoke {
    width: 100px; height: 100px;
    background: radial-gradient(circle, rgba(200,200,200,0.6) 0%, rgba(200,200,200,0) 70%);
    border-radius: 50%;
    animation: rise 2s forwards;
    position: absolute; bottom: 50px;
  }

  @keyframes rise { 0% { transform: translateY(0) scale(0.5); opacity: 0.8; } 100% { transform: translateY(-200px) scale(1); opacity: 0; } }

  .present {
    width: 100px; height: 100px; background: #ff8fab;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    display: flex; justify-content: center; align-items: center;
    font-size: 24px; color: white; cursor: pointer; position: relative; z-index: 10; user-select: none;
  }

  .roulette-container { position: relative; margin-top: 20px; }
  .roulette { width: 200px; height: 200px; border-radius: 50%; border:5px solid #ff4d6d; position: relative; overflow: hidden; }
  .slice { width:50%; height:50%; position:absolute; top:50%; left:50%; transform-origin:0% 0%; text-align:center; line-height:2; color:white; font-weight:bold; }
  .pointer { width:0; height:0; border-left:15px solid transparent; border-right:15px solid transparent; border-top:25px solid #ff4d6d; position:absolute; top:-25px; left:50%; transform:translateX(-50%); z-index:15; }
  .card { margin-top: 20px; width: 300px; height: 150px; background: linear-gradient(45deg,#ffe4e1,#ffb6c1); border-radius:15px; box-shadow:0 6px 20px rgba(0,0,0,0.3); display:flex; justify-content:center; align-items:center; font-size:20px; font-family:monospace; color:#333; }
  .youtube-container { margin-top:20px; }
</style>
</head>
<body>

<div class="envelope">
  <div class="flap"></div>
  <div class="bottom"></div>
  <div class="letter">
    <h2>ãŠèª•ç”Ÿæ—¥ãŠã‚ã§ã¨ã†ï¼</h2>
    <p>ã“ã‚Œã‹ã‚‰ã‚‚ãšã£ã¨ã„ã£ã±ã„è©±ãã†ã­ï¼</p>
  </div>
</div>

<div class="overlay"></div>
<div class="popup">
  <h2>ãŠèª•ç”Ÿæ—¥ãŠã‚ã§ã¨ã†ï¼</h2>
  <p>ã“ã‚Œã‹ã‚‰ã‚‚ãšã£ã¨ã„ã£ã±ã„è©±ãã†ã­ï¼</p>
</div>

<div id="bottom-section"></div>

<script>
const envelope = document.querySelector('.envelope');
const overlay = document.querySelector('.overlay');
const popup = document.querySelector('.popup');
const bottomSection = document.getElementById('bottom-section');

envelope.addEventListener('click', () => {
  envelope.classList.add('open');

  // ãƒãƒ¼ãƒˆç”Ÿæˆ
  let duration = 3000;
  let interval = 10;
  let elapsed = 0;
  let spawn = setInterval(() => {
    for(let i=0;i<2;i++) createHeart();
    elapsed+=interval;
    if(elapsed>=duration) clearInterval(spawn);
  }, interval);

  // æ‰‹ç´™æ‹¡å¤§è¡¨ç¤º
  setTimeout(()=> {
    overlay.classList.add('active');
    popup.classList.add('active');
  },800);
});

// æ‰‹ç´™é–‰ã˜ã‚‹ â†’ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼†ç…™ï¼‹ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ
overlay.addEventListener('click', () => {
  envelope.classList.remove('open');
  overlay.classList.remove('active');
  popup.classList.remove('active');

  bottomSection.scrollIntoView({behavior:'smooth'});

  for(let i=0;i<3;i++){
    let smoke = document.createElement('div');
    smoke.classList.add('smoke');
    smoke.style.left = (Math.random()*window.innerWidth/2+window.innerWidth/4)+'px';
    bottomSection.appendChild(smoke);
    setTimeout(()=>smoke.remove(),2000);
  }

  if(!document.querySelector('.present')){
    let present = document.createElement('div');
    present.classList.add('present');
    present.textContent = 'ğŸ';
    bottomSection.appendChild(present);
    present.addEventListener('click', ()=>startRoulette(present));
  }
});

// ãƒãƒ¼ãƒˆç”Ÿæˆ
function createHeart(){
  const heart = document.createElement('div');
  heart.classList.add('heart');
  heart.textContent='â¤';
  const startX = window.innerWidth/2 + (Math.random()*100-50);
  const startY = window.innerHeight/2;
  heart.style.left=startX+'px';
  heart.style.top=startY+'px';
  heart.style.fontSize=(20+Math.random()*20)+'px';
  document.body.appendChild(heart);

  let vx=(Math.random()-0.5)*2;
  let vy=-(2+Math.random()*2);
  let gravity=0.05 + Math.random()*0.05;
  let x=startX, y=startY;

  function animate(){
    x+=vx; y+=vy; vy+=gravity;
    heart.style.transform=`translate(${x}px, ${y}px)`;
    if(y<window.innerHeight) requestAnimationFrame(animate);
    else heart.remove();
  }
  animate();
}

// ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ
function startRoulette(present){
  if(document.querySelector('.roulette-container')) return;

  const container = document.createElement('div');
  container.classList.add('roulette-container');
  const pointer = document.createElement('div');
  pointer.classList.add('pointer');
  container.appendChild(pointer);

  const roulette = document.createElement('div');
  roulette.classList.add('roulette');
  const items = ['ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆãªã—','ãƒ­ãƒãƒƒã‚¯ã‚¹','æ„›æƒ…','çµå©š'];
  const colors = ['#ff4d6d','#ff8fab','#ffb3c6','#ffc1d6'];

  items.forEach((item,index)=>{
    const slice = document.createElement('div');
    slice.classList.add('slice');
    slice.textContent=item;
    slice.style.transform=`rotate(${index*90}deg) translate(0,-100%)`;
    slice.style.background = colors[index];
    roulette.appendChild(slice);
  });

  container.appendChild(roulette);
  bottomSection.appendChild(container);

  let rotation = 45; // åˆæœŸå‚¾ã
  let target = 45 + 180; // ã•ã‚‰ã«180Â°å›è»¢
  let speed = 30;

  function spin(){
    rotation += speed;
    speed *= 0.97;
    roulette.style.transform = `rotate(${rotation}deg)`;
    if(speed>0.5) requestAnimationFrame(spin);
    else {
      roulette.style.transform = `rotate(${target}deg)`;
      // åœæ­¢å¾Œã‚«ãƒ¼ãƒ‰ã¨YouTube
      const card = document.createElement('div');
      card.classList.add('card');
      card.textContent = 'ABCD1234EFGH5678';
      bottomSection.appendChild(card);

      const youtube = document.createElement('div');
      youtube.classList.add('youtube-container');
      youtube.innerHTML = `<iframe width="560" height="315" src="https://www.youtube.com/embed/XxK5kphQuz4" frameborder="0" allowfullscreen></iframe>`;
      bottomSection.appendChild(youtube);
    }
  }
  spin();
}
</script>
</body>
</html>
